CREATE DATABASE IF NOT EXISTS art;
USE art;
--
delimiter #
drop procedure if exists isprime#
create procedure isprime( IN n int, IN tabsiz int, OUT a boolean)
this_lab: begin
    set @j = 1;
    set a = true;
    while @j < tabsiz do
        set @p = (SELECT pr_n FROM Primes where pr_j = @j);
        set @r = n % @p;
        if @r = 0 then
            set a = false;
            leave this_lab;
        end if;
        set @q = n div @p;
        if @q <= @p then
            leave this_lab;
        end if;
        set @j = @j + 1;
    end while;
end#
delimiter ;
drop table if exists Primes;
CREATE TABLE Primes(
pr_j INT( 4) UNSIGNED AUTO_INCREMENT PRIMARY KEY, 
pr_n INT( 4) UNSIGNED NOT NULL);
INSERT INTO Primes (pr_n) VALUES( 2);
INSERT INTO Primes (pr_n) VALUES( 3);
delimiter ?
drop procedure if exists dothetab?
CREATE PROCEDURE dothetab()
begin /* beginze */
    set @tabmax := 500; -- what is this?
    set @tabsiz := 2;
    set @n := 5;
    start transaction;
    while @tabsiz < @tabmax do
        call isprime( @n, @tabsiz, @a); -- output at a(nswer)
        if @a = true then
            insert into Primes (pr_n) values ( @n);
            set @tabsiz = @tabsiz + 1;
        end if;
        set @n = @n + 2;
    end while;
    commit;
end?
delimiter ;
--
call dothetab();
delimiter //
drop procedure if exists dmp//
create procedure dmp()
begin
    drop table if exists PrimesTab;
    CREATE TABLE PrimesTab(
    pt_j INT( 4) UNSIGNED AUTO_INCREMENT PRIMARY KEY, 
    pt_l VARCHAR( 50) NOT NULL);
    set @i = 0;
    while @i < 50 do
        set @line = "";
        set @j = 0;
        while @j < 500 do
            set @k = @i + @j + 1;
            set @p = (SELECT pr_n FROM Primes where pr_j = @k);
            set @line = concat_ws( ' ', @line, lpad( @p, 4, 0));
            set @j = @j + 50;
        end while;
        insert into PrimesTab (pt_l) values ( @line);
        set @i = @i + 1;
    end while;
    select pt_j as "j", pt_l as "Table of first 500 primes" from PrimesTab;
end//
delimiter ;
call dmp();
-- ----- -----------------------------------------------
-- log: - After long thinking.. 
-- +----+----------------------------------------------------+
-- | j  | Table of first 500 primes                          |
-- +----+----------------------------------------------------+
-- |  1 |  0002 0233 0547 0877 1229 1597 1993 2371 2749 3187 |
-- |  2 |  0003 0239 0557 0881 1231 1601 1997 2377 2753 3191 |
-- |  3 |  0005 0241 0563 0883 1237 1607 1999 2381 2767 3203 |
-- |  4 |  0007 0251 0569 0887 1249 1609 2003 2383 2777 3209 |
-- |  5 |  0011 0257 0571 0907 1259 1613 2011 2389 2789 3217 |
-- |  6 |  0013 0263 0577 0911 1277 1619 2017 2393 2791 3221 |
-- |  7 |  0017 0269 0587 0919 1279 1621 2027 2399 2797 3229 |
-- |  8 |  0019 0271 0593 0929 1283 1627 2029 2411 2801 3251 |
-- |  9 |  0023 0277 0599 0937 1289 1637 2039 2417 2803 3253 |
-- | 10 |  0029 0281 0601 0941 1291 1657 2053 2423 2819 3257 |
-- | 11 |  0031 0283 0607 0947 1297 1663 2063 2437 2833 3259 |
-- | 12 |  0037 0293 0613 0953 1301 1667 2069 2441 2837 3271 |
-- | 13 |  0041 0307 0617 0967 1303 1669 2081 2447 2843 3299 |
-- | 14 |  0043 0311 0619 0971 1307 1693 2083 2459 2851 3301 |
-- | 15 |  0047 0313 0631 0977 1319 1697 2087 2467 2857 3307 |
-- | 16 |  0053 0317 0641 0983 1321 1699 2089 2473 2861 3313 |
-- | 17 |  0059 0331 0643 0991 1327 1709 2099 2477 2879 3319 |
-- | 18 |  0061 0337 0647 0997 1361 1721 2111 2503 2887 3323 |
-- | 19 |  0067 0347 0653 1009 1367 1723 2113 2521 2897 3329 |
-- | 20 |  0071 0349 0659 1013 1373 1733 2129 2531 2903 3331 |
-- | 21 |  0073 0353 0661 1019 1381 1741 2131 2539 2909 3343 |
-- | 22 |  0079 0359 0673 1021 1399 1747 2137 2543 2917 3347 |
-- | 23 |  0083 0367 0677 1031 1409 1753 2141 2549 2927 3359 |
-- | 24 |  0089 0373 0683 1033 1423 1759 2143 2551 2939 3361 |
-- | 25 |  0097 0379 0691 1039 1427 1777 2153 2557 2953 3371 |
-- | 26 |  0101 0383 0701 1049 1429 1783 2161 2579 2957 3373 |
-- | 27 |  0103 0389 0709 1051 1433 1787 2179 2591 2963 3389 |
-- | 28 |  0107 0397 0719 1061 1439 1789 2203 2593 2969 3391 |
-- | 29 |  0109 0401 0727 1063 1447 1801 2207 2609 2971 3407 |
-- | 30 |  0113 0409 0733 1069 1451 1811 2213 2617 2999 3413 |
-- | 31 |  0127 0419 0739 1087 1453 1823 2221 2621 3001 3433 |
-- | 32 |  0131 0421 0743 1091 1459 1831 2237 2633 3011 3449 |
-- | 33 |  0137 0431 0751 1093 1471 1847 2239 2647 3019 3457 |
-- | 34 |  0139 0433 0757 1097 1481 1861 2243 2657 3023 3461 |
-- | 35 |  0149 0439 0761 1103 1483 1867 2251 2659 3037 3463 |
-- | 36 |  0151 0443 0769 1109 1487 1871 2267 2663 3041 3467 |
-- | 37 |  0157 0449 0773 1117 1489 1873 2269 2671 3049 3469 |
-- | 38 |  0163 0457 0787 1123 1493 1877 2273 2677 3061 3491 |
-- | 39 |  0167 0461 0797 1129 1499 1879 2281 2683 3067 3499 |
-- | 40 |  0173 0463 0809 1151 1511 1889 2287 2687 3079 3511 |
-- | 41 |  0179 0467 0811 1153 1523 1901 2293 2689 3083 3517 |
-- | 42 |  0181 0479 0821 1163 1531 1907 2297 2693 3089 3527 |
-- | 43 |  0191 0487 0823 1171 1543 1913 2309 2699 3109 3529 |
-- | 44 |  0193 0491 0827 1181 1549 1931 2311 2707 3119 3533 |
-- | 45 |  0197 0499 0829 1187 1553 1933 2333 2711 3121 3539 |
-- | 46 |  0199 0503 0839 1193 1559 1949 2339 2713 3137 3541 |
-- | 47 |  0211 0509 0853 1201 1567 1951 2341 2719 3163 3547 |
-- | 48 |  0223 0521 0857 1213 1571 1973 2347 2729 3167 3557 |
-- | 49 |  0227 0523 0859 1217 1579 1979 2351 2731 3169 3559 |
-- | 50 |  0229 0541 0863 1223 1583 1987 2357 2741 3181 3571 |
-- +----+----------------------------------------------------+
-- 
